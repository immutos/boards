VERSION 0.8

bookworm-base:
  FROM debian:bookworm
  ENV DO_NOT_TRACK=1
  RUN apt update
  RUN apt install -y build-essential \
    crossbuild-essential-arm64 g++-riscv64-linux-gnu gcc-riscv64-linux-gnu \
    bc bison flex libssl-dev swig python3 python3-dev python3-setuptools \
    libncurses-dev libssl-dev libelf-dev curl debhelper fakeroot git \
    linux-source
  RUN mkdir -p /workspace \
    && tar -xf /usr/src/linux-source-6.1.tar.xz -C /workspace
  WORKDIR /workspace/linux-source-6.1
  ENV KERNELVERSION=$(make kernelversion)

trixie-base:
  FROM debian:trixie
  ENV DO_NOT_TRACK=1
  RUN apt update \
    && apt install -y curl \
    && curl -fL -o /etc/apt/keyrings/apt-immutos-com-keyring.asc https://apt.immutos.com/signing_key.asc \
    && echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/apt-immutos-com-keyring.asc] http://apt.immutos.com bookworm stable" > /etc/apt/sources.list.d/apt-immutos-com.list \
    && apt update
  RUN apt install -y build-essential \
    crossbuild-essential-arm64 g++-riscv64-linux-gnu gcc-riscv64-linux-gnu \
    bc bison flex libssl-dev swig python3 python3-dev python3-setuptools \
    libncurses-dev libssl-dev libelf-dev curl debhelper fakeroot git usrmerger \
    linux-source
  RUN mkdir -p /workspace \
    && tar -xf /usr/src/linux-source-6.10.tar.xz -C /workspace
  WORKDIR /workspace/linux-source-6.10
  ENV KERNELVERSION=$(make kernelversion)

bootloader-base:
  FROM +bookworm-base
  WORKDIR /workspace
  GIT CLONE --branch=24.08 https://github.com/coreboot/coreboot.git coreboot
  GIT CLONE --branch=v2024.01 https://github.com/u-boot/u-boot.git u-boot